<!DOCTYPE html>
<html lang="en"> <!-- Language fixed -->

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Yen Budget Manager</title>
    <meta name="color-scheme" content="light dark" />
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Chart.js CDN -->
    <script src="https://unpkg.com/chart.js@4.4.1/dist/chart.umd.js" defer></script>
    <link rel="stylesheet" href="style.css" />
</head>

<body>
    <header>
        <div class="header-container">
            <div class="brand">
                <div class="logo">¥</div>
                <div>Yen Budget Manager</div>
                <span class="tag" id="monthTag"></span>
            </div>
            <nav class="tabs" id="tabs" aria-label="Main navigation">
                <div class="tab active" data-view="dashboard" role="button" tabindex="0">Dashboard</div>
                <div class="tab" data-view="transactions" role="button" tabindex="0">Transactions</div>
                <div class="tab" data-view="budgets" role="button" tabindex="0">Budgets</div>
                <div class="tab" data-view="reports" role="button" tabindex="0">Reports</div>
                <div class="tab" data-view="settings" role="button" tabindex="0">Settings</div>
            </nav>
            <div class="toolbar">
                <button class="btn" id="toggleTheme" title="Toggle Light / Dark (L)">🌓</button>
                <button class="btn" id="addQuick" title="Quick add (A)">➕ Add</button>
                <button class="btn" id="exportBtn" title="Open Export">⬇️ Export</button>
                <label class="btn">
                    ⬆️ Import
                    <input type="file" id="importFile" accept=".json,.csv" hidden />
                </label>
            </div>
        </div>
    </header>

    <main id="app">
        <!-- DASHBOARD -->
        <section id="dashboard" class="grid">
            <!-- Professional Header Section -->
            <div class="dashboard-header" style="grid-column: span 12;">
                <div class="welcome-section">
                    <h1 class="dashboard-title">Financial Dashboard</h1>
                    <p class="dashboard-subtitle">Welcome back! Here's your financial overview for <span id="currentMonthDisplay">August 2025</span></p>
                </div>
                <div class="dashboard-actions">
                    <button class="btn primary" onclick="openTab('transactions')">
                        <span class="btn-icon">➕</span>
                        New Transaction
                    </button>
                    <button class="btn" onclick="openTab('reports')">
                        <span class="btn-icon">📊</span>
                        View Reports
                    </button>
                    <div class="dashboard-export-dropdown">
                        <button class="btn export-btn" onclick="toggleExportDropdown()">
                            <span class="btn-icon">📤</span>
                            Export
                            <span class="dropdown-arrow">▼</span>
                        </button>
                        <div class="export-dropdown-menu" id="exportDropdown">
                            <button class="export-option" onclick="exportDashboardPDF()">
                                <span class="export-icon">📄</span>
                                Export as PDF
                            </button>
                            <button class="export-option" onclick="exportDashboardCSV()">
                                <span class="export-icon">📊</span>
                                Export as CSV
                            </button>
                            <button class="export-option" onclick="exportDashboardExcel()">
                                <span class="export-icon">📈</span>
                                Export as Excel
                            </button>
                        </div>
                    </div>
                    <button class="btn share-btn" onclick="shareDashboard()">
                        <span class="btn-icon">🔗</span>
                        Share
                    </button>
                </div>
            </div>

            <!-- Enhanced KPI Cards Row -->
            <div class="card kpi-overview" style="grid-column: span 12;">
                <div class="kpi-grid" id="kpis">
                    <!-- KPI cards will be populated by JavaScript -->
                </div>
            </div>

            <!-- Financial Overview Chart -->
            <div class="card financial-chart" style="grid-column: span 8;">
                <div class="section-header">
                    <span class="icon">📈</span>
                    <h3>Financial Performance</h3>
                    <div class="chart-controls">
                        <select class="chart-period-selector" id="chartPeriod">
                            <option value="7">Last 7 Days</option>
                            <option value="30" selected>Last 30 Days</option>
                            <option value="90">Last 3 Months</option>
                            <option value="365">Last Year</option>
                        </select>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="financialChart" height="300"></canvas>
                </div>
            </div>

            <!-- Quick Actions Section -->
            <div class="card quick-actions" style="grid-column: span 4;">
                <div class="section-header">
                    <span class="icon">⚡</span>
                    <h3>Quick Actions</h3>
                </div>
                <div class="action-grid">
                    <button class="action-card income" onclick="openTab('transactions')">
                        <div class="action-icon">💰</div>
                        <div class="action-content">
                            <h4>Add Income</h4>
                            <p>Record new income</p>
                        </div>
                    </button>
                    <button class="action-card expense" onclick="openTab('transactions')">
                        <div class="action-icon">💸</div>
                        <div class="action-content">
                            <h4>Add Expense</h4>
                            <p>Log new expense</p>
                        </div>
                    </button>
                    <button class="action-card budget" onclick="openTab('budgets')">
                        <div class="action-icon">📊</div>
                        <div class="action-content">
                            <h4>Set Budget</h4>
                            <p>Create budget plan</p>
                        </div>
                    </button>
                    <button class="action-card goal" onclick="openTab('budgets')">
                        <div class="action-icon">🎯</div>
                        <div class="action-content">
                            <h4>Set Goal</h4>
                            <p>Define savings goal</p>
                        </div>
                    </button>
                </div>
            </div>

            <!-- Enhanced Recent Transactions -->
            <div class="card recent-transactions" style="grid-column: span 6;">
                <div class="section-header">
                    <span class="icon">📋</span>
                    <h3>Recent Transactions</h3>
                    <button class="view-all-btn" id="viewAllBtn" onclick="openTab('transactions');">View All</button>
                </div>
                <div class="transactions-list" id="recentTransactionsList">
                    <!-- Transactions will be populated by JavaScript -->
                </div>
                <div class="transaction-summary">
                    <div class="summary-item">
                        <span class="label">Total This Month</span>
                        <span class="value" id="monthlyTotal">¥0</span>
                    </div>
                    <div class="summary-item">
                        <span class="label">Transactions</span>
                        <span class="value" id="transactionCount">0</span>
                    </div>
                </div>
            </div>

            <!-- Enhanced Savings Overview -->
            <div class="card savings-overview" style="grid-column: span 3;">
                <div class="section-header">
                    <span class="icon">💎</span>
                    <h3>Savings Overview</h3>
                </div>
                <div class="savings-metrics">
                    <div class="metric-card primary">
                        <div class="metric-icon">💰</div>
                        <div class="metric-content">
                            <span class="metric-label">Total Saved</span>
                            <span class="metric-value" id="totalSaved">¥0</span>
                        </div>
                    </div>
                    <div class="metric-card success">
                        <div class="metric-icon">📈</div>
                        <div class="metric-content">
                            <span class="metric-label">Savings Rate</span>
                            <span class="metric-value" id="savingsRate">100%</span>
                        </div>
                    </div>
                </div>
                <div class="savings-goal">
                    <h4>Monthly Goal Progress</h4>
                    <div class="goal-progress">
                        <div class="goal-bar">
                            <div class="goal-fill" id="goalProgress"></div>
                        </div>
                        <div class="goal-text">
                            <span id="monthlyGoal">¥0 / ¥0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Month Progress -->
            <div class="card month-progress" style="grid-column: span 3;">
                <div class="section-header">
                    <span class="icon">📅</span>
                    <h3>Month Progress</h3>
                </div>
                <div class="progress-metrics">
                    <div class="progress-metric">
                        <div class="progress-circle" id="monthProgressCircle">
                            <svg viewBox="0 0 36 36">
                                <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                            </svg>
                            <div class="progress-text">
                                <span class="progress-number" id="monthProgressPercent">0%</span>
                            </div>
                        </div>
                        <span class="progress-label">Month Complete</span>
                    </div>
                    <div class="time-metrics">
                        <div class="time-metric">
                            <span class="time-label">Days Completed</span>
                            <span class="time-value" id="daysCompleted">0</span>
                        </div>
                        <div class="time-metric">
                            <span class="time-label">Days Remaining</span>
                            <span class="time-value" id="daysRemaining">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Budget Status Overview -->
            <div class="card budget-overview" style="grid-column: span 6;">
                <div class="section-header">
                    <span class="icon">🏦</span>
                    <h3>Budget Status</h3>
                    <button class="view-all-btn" onclick="openTab('budgets');">Manage Budgets</button>
                </div>
                <div class="budget-grid" id="budgetOverview">
                    <!-- Budget items will be populated by JavaScript -->
                </div>
            </div>

            <!-- Financial Insights -->
            <div class="card financial-insights" style="grid-column: span 6;">
                <div class="section-header">
                    <span class="icon">💡</span>
                    <h3>Financial Insights</h3>
                </div>
                <div class="insights-container" id="insightsContainer">
                    <!-- Insights will be populated by JavaScript -->
                </div>
            </div>

            <!-- Monthly Trend Chart Section -->
            <div class="card trend-chart" style="grid-column: span 5;">
                <div class="section-header">
                    <span class="icon">📊</span>
                    <h3>Monthly Trend</h3>
                    <select class="trend-selector" id="trendSelector">
                        <option value="12">Last 12 months</option>
                        <option value="6">Last 6 months</option>
                        <option value="3">Last 3 months</option>
                    </select>
                </div>
                <canvas id="trendChart" height="200"></canvas>
            </div>

            <!-- Budget Status Section -->
            <div class="card budget-status" style="grid-column: span 3;">
                <div class="section-header">
                    <span class="icon">🏦</span>
                    <h3>Budget Status</h3>
                </div>
                <div id="budgetStatusContent" class="budget-status-content">
                    <div class="empty-state">
                        <span class="empty-icon">📊</span>
                        <p>No budget set</p>
                    </div>
                </div>
            </div>

            <!-- Financial Insights Section -->
            <div class="card financial-insights" style="grid-column: span 4;">
                <div class="section-header">
                    <span class="icon">💡</span>
                    <h3>Financial Insights</h3>
                </div>
                <div class="insight-content" id="insightContent">
                    <div class="insight-item">
                        <span class="insight-icon">✅</span>
                        <span class="insight-text">Excellent Savings Rate</span>
                    </div>
                    <div class="insight-details">
                        Great job! Your <span id="insightRate">100.0%</span> savings rate is excellent. Consider investing excess funds.
                    </div>
                </div>
            </div>

            <!-- Upcoming Recurring Section -->
            <div class="card upcoming-recurring" style="grid-column: span 4;">
                <div class="section-header">
                    <span class="icon">🔔</span>
                    <h3>Upcoming Recurring</h3>
                </div>
                <div id="upcomingRecurring" class="upcoming-content">
                    <div class="empty-state">
                        <span class="empty-icon">📅</span>
                        <p>No upcoming recurring transactions</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Share Modal -->
        <div class="share-modal" id="shareModal">
            <div class="share-modal-content">
                <div class="share-modal-header">
                    <h3 class="share-modal-title">Share Dashboard</h3>
                    <button class="share-modal-close" onclick="closeShareModal()">×</button>
                </div>
                
                <div class="share-options">
                    <button class="share-option" onclick="shareViaEmail()">
                        <div class="share-option-icon">📧</div>
                        <div class="share-option-text">Email</div>
                    </button>
                    <button class="share-option" onclick="shareViaWhatsApp()">
                        <div class="share-option-icon">💬</div>
                        <div class="share-option-text">WhatsApp</div>
                    </button>
                    <button class="share-option" onclick="shareViaTwitter()">
                        <div class="share-option-icon">🐦</div>
                        <div class="share-option-text">Twitter</div>
                    </button>
                    <button class="share-option" onclick="shareViaLinkedIn()">
                        <div class="share-option-icon">💼</div>
                        <div class="share-option-text">LinkedIn</div>
                    </button>
                </div>
                
                <div class="share-link-section">
                    <label class="share-link-label">Or copy this link:</label>
                    <div class="share-link-input">
                        <input type="text" id="shareLink" readonly value="https://your-app.com/dashboard" />
                        <button class="copy-link-btn" onclick="copyShareLink()">Copy Link</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Export Success Notification -->
        <div class="export-success" id="exportSuccess">
            <div class="export-success-content">
                <span class="export-success-icon">✅</span>
                <span class="export-success-text" id="exportSuccessText">Export successful!</span>
            </div>
        </div>

        <!-- TRANSACTIONS -->
        <section id="transactions" class="grid hidden" aria-hidden="true">
            <div class="card" style="grid-column: span 4;">
                <h2>New Transaction</h2>
                <form id="txForm" class="stack">
                    <div class="row">
                        <div>
                            <label>Type</label>
                            <select name="type" required>
                                <option value="expense">Expense</option>
                                <option value="income">Income</option>
                            </select>
                        </div>
                        <div>
                            <label>Category</label>
                            <!-- Fixed: placeholder in English -->
                            <input name="category" id="category" list="catList" placeholder="e.g., Food, Rent" autocomplete="off">
                            <datalist id="catList"></datalist>
                        </div>
                    </div>
                    <div class="row">
                        <div>
                            <label>Amount (¥)</label>
                            <input name="amount" type="number" step="1" min="0" required />
                        </div>
                        <div>
                            <label>Date</label>
                            <input name="date" type="date" required />
                        </div>
                    </div>
                    <div>
                        <label>Note</label>
                        <!-- Fixed: English -->
                        <input name="note" placeholder="Note (optional)" />
                    </div>
                    <div class="row">
                        <div>
                            <label>Recurring</label>
                            <select name="recurring">
                                <option value="none">None</option>
                                <option value="weekly">Weekly</option>
                                <option value="monthly">Monthly</option>
                                <option value="yearly">Yearly</option>
                            </select>
                        </div>
                        <div>
                            <label>Next Occurrence</label>
                            <input name="next" type="date" />
                        </div>
                    </div>
                    <div class="row">
                        <button class="btn primary" type="submit">Save Transaction</button>
                        <button class="btn" type="reset">Reset</button>
                    </div>
                </form>
                <div class="tips" style="margin-top:12px;">
                    <b>Tips</b><br>
                    Ctrl+T — Quick add transaction<br>
                    Ctrl+L — Toggle light/dark<br>
                    Ctrl+/ — Focus category filter<br>
                    Recurring items auto-post on app load if due.
                </div>
            </div>
            <div class="card" style="grid-column: span 8;">
                <div class="row" style="align-items:flex-end">
                    <h2 style="margin:0">All Transactions</h2>
                    <div class="right"></div>
                    <div>
                        <label>Filter by Category</label>
                        <input id="filterCat" list="catList" placeholder="(all)" />
                    </div>
                    <div>
                        <label>Month</label>
                        <input id="filterMonth" type="month" />
                    </div>
                    <button class="btn" id="clearFilters">Clear</button>
                </div>
                <div class="table-scroll">
                    <table class="list" id="txTable">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Type</th>
                                <th>Category</th>
                                <th>Note</th>
                                <th class="right">Amount</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- BUDGETS -->
        <section id="budgets" class="grid hidden">
            <div class="card" style="grid-column: span 4;">
                <h2>Category Budget</h2>
                <form id="budgetForm" class="stack">
                    <div>
                        <label>Category</label>
                        <input name="category" list="catList" placeholder="e.g., Food" required />
                    </div>
                    <div>
                        <label>Monthly Budget (¥)</label>
                        <input name="amount" type="number" step="1" min="0" required />
                    </div>
                    <div class="row">
                        <button class="btn primary" type="submit">Save Budget</button>
                        <button class="btn danger" type="button" id="deleteBudget">Delete</button>
                    </div>
                </form>
                
                <h3>Saving Goal</h3>
                <form id="goalForm" class="stack">
                    <div class="row">
                        <div>
                            <label>Monthly Income (¥)</label>
                            <input name="income" type="number" step="1" min="0" />
                        </div>
                        <div>
                            <label>Target Save %</label>
                            <input name="rate" type="number" step="1" min="0" max="100" placeholder="20" />
                        </div>
                    </div>
                    <button class="btn" type="submit">Save Goal</button>
                    <div class="muted" id="goalNote"></div>
                </form>
                
                <h3>Add Income</h3>
                <form id="incomeForm" class="stack">
                    <div>
                        <label>Category</label>
                        <input name="incomeCategory" list="catList" placeholder="e.g., Salary, Bonus" required />
                    </div>
                    <div>
                        <label>Amount (¥)</label>
                        <input name="incomeAmount" type="number" step="1" min="0" required />
                    </div>
                    <div>
                        <label>Date</label>
                        <input name="incomeDate" type="date" required />
                    </div>
                    <div>
                        <label>Note (optional)</label>
                        <input name="incomeNote" placeholder="Note (optional)" />
                    </div>
                    <div class="row">
                        <button class="btn" type="reset">Reset</button>
                        <button class="btn primary" type="submit">Save Income</button>
                    </div>
                </form>
            </div>

            <div class="card" style="grid-column: span 8;">
                <h2>Budgets Overview</h2>
                <div class="table-scroll">
                    <table class="list" id="budgetTable">
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Budget</th>
                                <th>Spent</th>
                                <th>Remaining</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="budgetTableBody">
                            <!-- Budgets will be rendered here by JS -->
                        </tbody>
                    </table>
                </div>
                
                <h3>Savings from Categories</h3>
                <div class="savings-categories" id="savingsCategories">
                    <!-- Category savings will be rendered here by JS -->
                </div>
            </div>
        </section>

        <!-- REPORTS -->
        <section id="reports" class="grid hidden">
            <!-- Professional Report Header -->
            <div class="card report-header" style="grid-column: span 12;">
                <div class="report-header-content">
                    <div class="report-title-section">
                        <h1 class="report-main-title">Financial Reports & Analytics</h1>
                        <p class="report-subtitle">Comprehensive financial insights for <span id="reportPeriodDisplay">August 2025</span></p>
                        <div class="report-period-selector">
                            <select id="reportPeriod" class="period-selector">
                                <option value="current">Current Month</option>
                                <option value="last3">Last 3 Months</option>
                                <option value="last6">Last 6 Months</option>
                                <option value="last12">Last 12 Months</option>
                                <option value="custom">Custom Range</option>
                            </select>
                            <button class="btn primary" id="generateReport">
                                <span class="btn-icon">📊</span>
                                Generate Report
                            </button>
                        </div>
                    </div>
                    <div class="report-actions">
                        <button type="button" id="exportToPDF" class="btn export-btn">
                            <span class="btn-icon">📄</span>
                            Export PDF
                        </button>
                        <button type="button" id="exportToExcel" class="btn export-btn">
                            <span class="btn-icon">📊</span>
                            Export Excel
                        </button>
                        <button type="button" id="exportToCSV" class="btn export-btn">
                            <span class="btn-icon">📋</span>
                            Export CSV
                        </button>
                        <button type="button" id="shareReport" class="btn share-btn">
                            <span class="btn-icon">🔗</span>
                            Share
                        </button>
                        <button type="button" id="printReport" class="btn print-btn">
                            <span class="btn-icon">🖨️</span>
                            Print
                        </button>
                    </div>
                </div>
                <!-- Real-time Status Indicator -->
                <div class="real-time-status" id="realTimeStatus">
                    <div class="status-icon"></div>
                    <span>Real-time data active</span>
                </div>
                <!-- Real-time Timestamp -->
                <div class="real-time-timestamp" id="realTimeTimestamp">
                    Last updated: <span id="lastUpdateTime">Just now</span>
                </div>
            </div>

            <!-- Executive Summary Cards -->
            <div class="card summary-overview" style="grid-column: span 12;">
                <div class="section-header">
                    <span class="icon">📈</span>
                    <h3>Executive Summary</h3>
                </div>
                <div class="summary-grid" id="summaryGrid">
                    <div class="summary-card income">
                        <div class="summary-icon">💰</div>
                        <div class="summary-content">
                            <h4>Total Income</h4>
                            <div class="summary-value" id="summaryIncome">¥0</div>
                            <div class="summary-change positive" id="summaryIncomeChange">+0.0%</div>
                        </div>
                    </div>
                    <div class="summary-card expense">
                        <div class="summary-icon">💸</div>
                        <div class="summary-content">
                            <h4>Total Expenses</h4>
                            <div class="summary-value" id="summaryExpense">¥0</div>
                            <div class="summary-change negative" id="summaryExpenseChange">+0.0%</div>
                        </div>
                    </div>
                    <div class="summary-card savings">
                        <div class="summary-icon">🏦</div>
                        <div class="summary-content">
                            <h4>Net Savings</h4>
                            <div class="summary-value" id="summarySavings">¥0</div>
                            <div class="summary-change" id="summarySavingsChange">+0.0%</div>
                        </div>
                    </div>
                    <div class="summary-card savings-rate">
                        <div class="summary-icon">📊</div>
                        <div class="summary-content">
                            <h4>Savings Rate</h4>
                            <div class="summary-value" id="summarySavingsRate">0.0%</div>
                            <div class="summary-change" id="summarySavingsRateChange">+0.0%</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Charts Row 1 -->
            <div class="card chart-card enhanced" style="grid-column: span 8;">
                <div class="chart-header">
                    <h3>Financial Performance Overview</h3>
                    <div class="chart-controls">
                        <select id="chartType" class="chart-type-selector">
                            <option value="line">Line Chart</option>
                            <option value="bar">Bar Chart</option>
                            <option value="area">Area Chart</option>
                        </select>
                        <div class="chart-legend">
                            <span class="legend-item income">● Income</span>
                            <span class="legend-item expense">● Expense</span>
                            <span class="legend-item savings">● Savings</span>
                        </div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="financialOverviewChart" height="300"></canvas>
                </div>
            </div>

            <div class="card chart-card enhanced" style="grid-column: span 4;">
                <div class="chart-header">
                    <h3>Category Distribution</h3>
                    <div class="chart-controls">
                        <select id="pieChartType" class="chart-type-selector">
                            <option value="expense">Expenses</option>
                            <option value="income">Income</option>
                        </select>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="categoryDistributionChart" height="300"></canvas>
                </div>
            </div>

            <!-- Enhanced Charts Row 2 -->
            <div class="card chart-card enhanced" style="grid-column: span 6;">
                <div class="chart-header">
                    <h3>Monthly Trends Analysis</h3>
                    <div class="chart-controls">
                        <select id="trendPeriod" class="chart-type-selector">
                            <option value="6">6 Months</option>
                            <option value="12">12 Months</option>
                            <option value="24">24 Months</option>
                        </select>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="monthlyTrendsChart" height="300"></canvas>
                </div>
            </div>

            <div class="card chart-card enhanced" style="grid-column: span 6;">
                <div class="chart-header">
                    <h3>Budget vs Actual Performance</h3>
                    <div class="chart-controls">
                        <select id="budgetChartType" class="chart-type-selector">
                            <option value="comparison">Comparison</option>
                            <option value="variance">Variance</option>
                        </select>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="budgetPerformanceChart" height="300"></canvas>
                </div>
            </div>

            <!-- Enhanced Analysis Cards Row 1 -->
            <div class="card analysis-card enhanced" style="grid-column: span 6;">
                <div class="card-header">
                    <h3>Financial Health Metrics</h3>
                    <p class="subtitle">Key performance indicators and trends</p>
                </div>
                <div class="analysis-content">
                    <div class="metric-item">
                        <div class="metric-header">
                            <span class="metric-label">Monthly Burn Rate</span>
                            <span class="metric-trend positive">↗️</span>
                        </div>
                        <div class="metric-value" id="monthlyBurnRate">¥0/day</div>
                        <div class="metric-description">Average daily spending</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-header">
                            <span class="metric-label">Emergency Fund Status</span>
                            <span class="metric-trend positive">✅</span>
                        </div>
                        <div class="metric-value" id="emergencyFundStatus">Good</div>
                        <div class="metric-description">3+ months of expenses covered</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-header">
                            <span class="metric-label">Debt-to-Income Ratio</span>
                            <span class="metric-trend negative">⚠️</span>
                        </div>
                        <div class="metric-value" id="debtToIncomeRatio">0.0%</div>
                        <div class="metric-description">Target: Below 30%</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-header">
                            <span class="metric-label">Investment Rate</span>
                            <span class="metric-trend positive">📈</span>
                        </div>
                        <div class="metric-value" id="investmentRate">0.0%</div>
                        <div class="metric-description">% of income invested</div>
                    </div>
                </div>
            </div>

            <div class="card analysis-card enhanced" style="grid-column: span 6;">
                <div class="card-header">
                    <h3>Budget Performance Analysis</h3>
                    <p class="subtitle">Category-wise budget utilization</p>
                </div>
                <div class="budget-performance-enhanced" id="budgetPerformanceEnhanced">
                    <!-- Budget performance will be populated by JavaScript -->
                </div>
            </div>

            <!-- Enhanced Analysis Cards Row 2 -->
            <div class="card analysis-card enhanced" style="grid-column: span 6;">
                <div class="card-header">
                    <h3>Year-over-Year Comparison</h3>
                    <p class="subtitle">Annual growth and performance metrics</p>
                </div>
                <div class="yoy-analysis" id="yoyAnalysis">
                    <div class="yoy-item">
                        <div class="yoy-header">
                            <span class="yoy-label">Income Growth</span>
                            <span class="yoy-period">2024 → 2025</span>
                        </div>
                        <div class="yoy-value positive" id="yoyIncomeGrowth">+0.0%</div>
                        <div class="yoy-chart">
                            <div class="yoy-bar">
                                <div class="yoy-fill income" id="yoyIncomeBar"></div>
                            </div>
                        </div>
                    </div>
                    <div class="yoy-item">
                        <div class="yoy-header">
                            <span class="yoy-label">Expense Growth</span>
                            <span class="yoy-period">2024 → 2025</span>
                        </div>
                        <div class="yoy-value negative" id="yoyExpenseGrowth">+0.0%</div>
                        <div class="yoy-chart">
                            <div class="yoy-bar">
                                <div class="yoy-fill expense" id="yoyExpenseBar"></div>
                            </div>
                        </div>
                    </div>
                    <div class="yoy-item">
                        <div class="yoy-header">
                            <span class="yoy-label">Savings Growth</span>
                            <span class="yoy-period">2024 → 2025</span>
                        </div>
                        <div class="yoy-value" id="yoySavingsGrowth">+0.0%</div>
                        <div class="yoy-chart">
                            <div class="yoy-bar">
                                <div class="yoy-fill savings" id="yoySavingsBar"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card analysis-card enhanced" style="grid-column: span 6;">
                <div class="card-header">
                    <h3>Financial Insights & Recommendations</h3>
                    <p class="subtitle">AI-powered financial advice</p>
                </div>
                <div class="insights-container" id="financialInsights">
                    <div class="insight-item positive">
                        <div class="insight-icon">💡</div>
                        <div class="insight-content">
                            <h4>Strong Savings Rate</h4>
                            <p>Your savings rate is above average. Consider increasing investments for long-term growth.</p>
                        </div>
                    </div>
                    <div class="insight-item warning">
                        <div class="insight-icon">⚠️</div>
                        <div class="insight-content">
                            <h4>High Food Expenses</h4>
                            <p>Food spending is 25% above budget. Look for ways to reduce dining out costs.</p>
                        </div>
                    </div>
                    <div class="insight-item info">
                        <div class="insight-icon">ℹ️</div>
                        <div class="insight-content">
                            <h4>Budget Optimization</h4>
                            <p>Transport budget has room for optimization. Consider carpooling or public transport.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Export & Share Section -->
            <div class="card export-share-card" style="grid-column: span 12;">
                <div class="card-header">
                    <h3>Export & Share Options</h3>
                    <p class="subtitle">Generate and distribute professional reports</p>
                </div>
                <div class="export-options-grid">
                    <div class="export-option-card">
                        <div class="export-icon">📄</div>
                        <h4>PDF Report</h4>
                        <p>Professional PDF with charts, analysis, and insights</p>
                        <button type="button" id="exportPdfReport" class="btn primary">Export PDF</button>
                    </div>
                    <div class="export-option-card">
                        <div class="export-icon">📊</div>
                        <h4>Excel Report</h4>
                        <p>Detailed spreadsheet with raw data and calculations</p>
                        <button type="button" id="exportExcelReport" class="btn primary">Export Excel</button>
                    </div>
                    <div class="export-option-card">
                        <div class="export-icon">📱</div>
                        <h4>Share Report</h4>
                        <p>Share insights with family or financial advisor</p>
                        <button type="button" id="shareReportEnhanced" class="btn primary">Share Report</button>
                    </div>
                    <div class="export-option-card">
                        <div class="export-icon">🔄</div>
                        <h4>Schedule Reports</h4>
                        <p>Get monthly reports automatically</p>
                        <button type="button" id="scheduleReports" class="btn primary">Set Schedule</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Settings Section -->
        <section id="settings" class="hidden">
            <div class="section-header">
                <span class="icon">⚙️</span>
                <h2>Settings</h2>
            </div>
            
            <div class="settings-grid">
                <!-- Left Column: Export & Data Actions -->
                <div class="settings-column">
                    <!-- Export Options -->
                    <div class="card">
                        <div class="section-header">
                            <span class="icon">📤</span>
                            <h3>Export Options</h3>
                        </div>
                        <div class="setting-group">
                            <button type="button" id="exportJson" class="btn export-btn">Export JSON</button>
                            <button type="button" id="exportCsv" class="btn export-btn">Export CSV</button>
                            <button type="button" id="exportExcel" class="btn export-btn">Export Excel Report</button>
                        </div>
                    </div>

                    <!-- Import Options -->
                    <div class="card">
                        <div class="section-header">
                            <span class="icon">📥</span>
                            <h3>Import Options</h3>
                        </div>
                        <div class="setting-group">
                            <button type="button" id="importData" class="btn import-btn">Import Data</button>
                            <p class="import-note">Supports JSON and CSV formats.</p>
                        </div>
                    </div>

                    <!-- Data Actions -->
                    <div class="card">
                        <div class="section-header">
                            <span class="icon">🗄️</span>
                            <h3>Data Actions</h3>
                        </div>
                        <div class="setting-group">
                            <button type="button" id="createBackup" class="btn backup-btn">Create Backup</button>
                            <button type="button" id="wipe" class="btn danger">Wipe All Data</button>
                            <button type="button" id="debugState" class="btn warning">Debug State</button>
                            <button type="button" id="clearTransactions" class="btn warning">Clear Transactions</button>
                            <button type="button" id="resetState" class="btn danger">Reset State</button>
                            <button type="button" id="testTransaction" class="btn primary">Test Transaction</button>
                        </div>
                    </div>
                </div>

                <!-- Middle Column: Theme & Preferences -->
                <div class="settings-column">
                    <!-- Theme & Display -->
                    <div class="card">
                        <div class="section-header">
                            <span class="icon">🎨</span>
                            <h3>Theme & Display</h3>
                        </div>
                        <div class="setting-group">
                            <div class="setting-item">
                                <label for="themeSelector">Theme Mode</label>
                                <div class="theme-toggle">
                                    <button type="button" id="lightTheme" class="theme-option" data-theme="light">
                                        <span class="theme-icon">☀️</span>
                                        <span>Light</span>
                                    </button>
                                    <button type="button" id="darkTheme" class="theme-option active" data-theme="dark">
                                        <span class="theme-icon">🌙</span>
                                        <span>Dark</span>
                                    </button>
                                </div>
                            </div>
                            <div class="setting-item">
                                <label>Currency Display</label>
                                <div class="currency-display">
                                    <span class="currency-icon">¥</span>
                                    <span>Japanese Yen (JPY)</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Dashboard Preferences -->
                    <div class="card">
                        <div class="section-header">
                            <span class="icon">📊</span>
                            <h3>Dashboard Preferences</h3>
                        </div>
                        <div class="setting-group">
                            <div class="setting-item">
                                <label for="recentLimit">Recent Transactions Limit</label>
                                <select id="recentLimit">
                                    <option value="3">3 transactions</option>
                                    <option value="5" selected>5 transactions</option>
                                    <option value="10">10 transactions</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <label for="chartAnimations">Chart Animations</label>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="chartAnimations" checked>
                                    <label for="chartAnimations" class="toggle-label"></label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column: Quick Actions & About -->
                <div class="settings-column">
                    <!-- Quick Actions -->
                    <div class="card">
                        <div class="section-header">
                            <span class="icon">⚡</span>
                            <h3>Quick Actions</h3>
                        </div>
                        <div class="setting-group">
                            <div class="shortcut-item">
                                <kbd>Ctrl + T</kbd>
                                <span>Quick add transaction</span>
                            </div>
                            <div class="shortcut-item">
                                <kbd>Ctrl + L</kbd>
                                <span>Toggle light/dark theme</span>
                            </div>
                            <div class="shortcut-item">
                                <kbd>Ctrl + /</kbd>
                                <span>Focus category filter</span>
                            </div>
                            <div class="shortcut-item">
                                <kbd>Ctrl + E</kbd>
                                <span>Export data</span>
                            </div>
                            <div class="shortcut-item">
                                <kbd>Ctrl + S</kbd>
                                <span>Save current form</span>
                            </div>
                        </div>
                    </div>

                    <!-- About Yen Budget Manager -->
                    <div class="card">
                        <div class="section-header">
                            <span class="icon">ℹ️</span>
                            <h3>About Yen Budget Manager</h3>
                        </div>
                        <div class="setting-group">
                            <div class="version-info">
                                <strong>Version:</strong> 2.0.0
                            </div>
                            <div class="features-list">
                                <span class="feature-tag">Offline-first</span>
                                <span class="feature-tag">Local-only</span>
                                <span class="feature-tag">Chart.js Integration</span>
                                <span class="feature-tag">Excel Export</span>
                            </div>
                            <p class="about-description">
                                Built for clarity and speed. Your financial data stays private and local.
                            </p>
                            <div class="about-icons">
                                <span class="about-icon" title="Privacy">🔒</span>
                                <span class="about-icon" title="Local Storage">👤</span>
                                <span class="about-icon" title="Customizable">✏️</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Category Management Section (Full Width) -->
            <div class="category-management-section">
                <div class="card full-width">
                    <div class="section-header">
                        <span class="icon">🏷️</span>
                        <h3>Category Management</h3>
                    </div>
                    
                    <div class="category-controls">
                        <div class="category-input-group">
                            <label for="newCategoryInput">Enter new category name</label>
                            <div class="input-button-group">
                                <input type="text" id="newCategoryInput" placeholder="Enter category name..." maxlength="30" />
                                <button type="button" id="addCategoryBtn" class="btn primary">+ Add Category</button>
                            </div>
                        </div>
                        <div class="category-summary">
                            <span id="categoryCount">12 categories</span>
                            <span class="category-usage">2 in use</span>
                        </div>
                    </div>

                    <div class="category-grid" id="defaultCategories">
                        <!-- Categories will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </section>

    </main>

    <footer class="footer">© 2025 Yen Budget Manager — Local & Private</footer>

    <template id="rowTx">
        <tr>
            <td data-k="date"></td>
            <td data-k="type"></td>
            <td data-k="category"></td>
            <td data-k="note"></td>
            <td data-k="amount" class="right"></td>
            <td>
                <button class="btn" data-act="edit">✏️</button>
                <button class="btn danger" data-act="del">🗑️</button>
            </td>
        </tr>
    </template>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="script.js" defer></script>
</body>

</html>
